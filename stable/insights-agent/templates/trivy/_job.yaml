{{- define "trivy.job.spec" -}}
restartPolicy: Never
serviceAccountName: {{ include "insights-agent.fullname" . }}
securityContext:
  fsGroup: 412
volumes:
- name: output
  emptyDir: {}
containers:
- name: trivy
  image: quay.io/fairwinds/fw-trivy
  image: "{{ .Values.trivy.image.repository }}:{{ .Values.trivy.image.tag }}"
  command:
    - "./report.sh"
  volumeMounts:
  - name: output
    mountPath: /output
  securityContext:
    privileged: true
{{- $_ := set . "Label" "trivy" }}
{{- $_ := set . "Config" .Values.trivy }}
{{- include "uploaderContainer" . }}
{{- end }}
