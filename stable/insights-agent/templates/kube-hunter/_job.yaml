{{- define "kubehunter.job.spec" -}}
nodeSelector:
  node-role.kubernetes.io/master: ""
tolerations:
- key: node-role.kubernetes.io/master
  operator: Exists
  effect: NoSchedule
hostPID: true
restartPolicy: Never
serviceAccountName: fairwinds-agent
volumes:
- name: output
  emptyDir: {}
containers:
- name: kube-hunter
  image: "{{ .Values.kubehunter.image.repository }}:{{ .Values.kubehunter.image.tag }}"
  imagePullPolicy: Always
  command:
    - /bin/sh
    - -c
    - |
      python ./kube-hunter.py \
        --pod \
        --log none \
        --report json \
        --statistics \
      > /output/kube-hunter-tmp.json \
      && mv /output/kube-hunter-tmp.json /output/kube-hunter.json
  volumeMounts:
  - name: output
    mountPath: /output
{{- include "uploaderContainer" (dict "Label" "kube-hunter" "Config" .Values.kubehunter "Values" .Values) }}
{{- end -}}
